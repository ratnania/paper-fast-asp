\section{Matrix form of the variational problem}

\subsection{2D case}
We consider the discrete variational formulation of \eqref{eq:curl-variational-problem}. 
For the sake of simplicity we shall introduce the scalar functions
\begin{align*}
  \Psi^1_{\jj} = \Mjone \Njtwo 
  \\
  \Psi^2_{\jj} = \Njone \Mjtwo  
\end{align*}
we also define the vectors $\ee_1 = \begin{pmatrix} 1 \\ 0 \end{pmatrix}$ and $\ee_2 = \begin{pmatrix} 0 \\ 1 \end{pmatrix}$. Therefor, the expression of $\uu_h \in \Vcurl$ becomes
\begin{align*}
  \uu_h = \sum\limits_{\jj} \left( 
    u_{\jj}^1 \Psi^1_{\jj} \ee_1 
  + u_{\jj}^2 \Psi^2_{\jj} \ee_2 
  \right)
\end{align*}
we find that $A$ is a symmetric $2\times 2$ block matrix of the form
\begin{align}
  A = 
  \begin{pmatrix}
    A_{11}   & A_{12} \\
    A_{12}^T & A_{22} \\
  \end{pmatrix}
%  \label{}
\end{align}
where
\begin{align*}
  {A_{11}}_{\ii, \jj} &=   \int_{\Omega} 
         \partial_{x_2} \Psi^{1}_{\jj} \partial_{x_2} \Psi^{1}_{\ii}
        \dd \mathbf{x} 
                       +   \int_{\Omega} 
                       \tau \Psi^{1}_{\jj} \Psi^{1}_{\ii} 
        \dd \mathbf{x} 
  \\
  {A_{12}}_{\ii, \jj} &= - \int_{\Omega} 
          \partial_{x_2} \Psi^{1}_{\jj} \partial_{x_1} \Psi^{2}_{\ii}
        \dd \mathbf{x} 
  \\
  {A_{22}}_{\ii, \jj} &=   \int_{\Omega} 
        \partial_{x_1} \Psi^{2}_{\jj} ~ \partial_{x_1} \Psi^{2}_{\ii}
        \dd \mathbf{x} 
                       +   \int_{\Omega} 
                       \tau \Psi^{2}_{\jj} \Psi^{2}_{\ii} 
        \dd \mathbf{x} 
\end{align*}
For the right hand side, the entries associated to each component of the vector $\ff$ are given by
\begin{align*}
    F_{1, i} & = \int_{\Omega} \ff_1 \Psi^1_{i} \dd \mathbf{x} \\
    F_{2, i} & = \int_{\Omega} \ff_2 \Psi^2_{i} \dd \mathbf{x} \\
\end{align*}
\subsubsection*{Case without mapping}
When the computational domain is a cube, one can express the previous matrices in terms of Kronecker product.
Before expliciting the matrix forms in 2D and 3D, we start by introducing some 1D matrices that we will need.
\begin{align}
  \begin{cases}
    \left( M_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Nis \Njs \dd x_s
    \\
    \left( K_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Nis^\prime \Njs^\prime \dd x_s
    \\
    \left( D_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Mis \Mjs \dd x_s
    \\
    \left( R_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Nis^\prime \Mjs \dd x_s
  \end{cases}
\end{align}
Hence, we have,
\begin{align*}
  \begin{cases}
    {A_{11}}_{\ii, \jj} &= \left( D_1 \otimes K_2 \right)_{\ii \jj} 
                         + \tau \left( D_1 \otimes M_2 \right)_{\ii \jj} 
    \\
    {A_{12}}_{\ii, \jj} &= - \left( R_1 \otimes R_2^T \right)_{\ii \jj} 
    \\
    {A_{22}}_{\ii, \jj} &= \left( K_1 \otimes D_2 \right)_{\ii \jj} 
                         + \tau \left( M_1 \otimes D_2 \right)_{\ii \jj} 
  \end{cases}
\end{align*}
Therefor, we have the following matrix form 
\begin{align}
  \mathcal{A}^\tau = \mathcal{A}^0 + \tau \mathcal{M}
%  \label{}
\end{align}
where
\begin{align}
  \mathcal{A}^0 = 
  \begin{pmatrix}
        D_1 \otimes K_2  & - R_1 \otimes R_2^T  \\
    - R_1^T \otimes R_2  &   K_1 \otimes D_2 
  \end{pmatrix}
  \label{eq:matrix-A0-2d}
\end{align}
and
\begin{align}
  \mathcal{M} = 
  \begin{pmatrix}
    D_1 \otimes M_2   & 0  \\
    0 & M_1 \otimes D_2   
  \end{pmatrix}
  \label{eq:matrix-M-2d}
\end{align}

\subsection{3D case}
We consider the discrete variational formulation of \eqref{eq:curl-variational-problem}. 
For the sake of simplicity we shall introduce the scalar functions
\begin{align*}
  \Psi^1_{\jj} = \Mjone \Njtwo \Njtre 
  \\
  \Psi^2_{\jj} = \Njone \Mjtwo \Njtre  
  \\
  \Psi^3_{\jj} = \Njone \Njtwo \Mjtre  
\end{align*}
we also define the vectors $\ee_1 = \begin{pmatrix} 1 \\ 0 \\ 0 \end{pmatrix}$, $\ee_2 = \begin{pmatrix} 0 \\ 1 \\ 0 \end{pmatrix}$ and $\ee_3 = \begin{pmatrix} 0 \\ 0 \\ 1 \end{pmatrix}$. Therefor, the expression of $\uu_h \in \Vcurl$ becomes
\begin{align*}
  \uu_h = \sum\limits_{\jj} \left( 
    u_{\jj}^1 \Psi^1_{\jj} \ee_1 
  + u_{\jj}^2 \Psi^2_{\jj} \ee_2 
  + u_{\jj}^3 \Psi^3_{\jj} \ee_3 
  \right)
\end{align*}
On the other hand, we have,
\begin{align*}
 \Curl \Psi^{1}_{\jj} \ee_{1} &= 
   \partial_{x_3} \Psi^{1}_{\jj} \ee_2 
 - \partial_{x_2} \Psi^{1}_{\jj} \ee_3
 \\
 \Curl \Psi^{2}_{\jj} \ee_{2} &= 
 - \partial_{x_3} \Psi^{2}_{\jj} \ee_1
 + \partial_{x_1} \Psi^{2}_{\jj} \ee_3
 \\
 \Curl \Psi^{3}_{\jj} \ee_{3} &= 
   \partial_{x_2} \Psi^{3}_{\jj} \ee_1 
 - \partial_{x_1} \Psi^{3}_{\jj} \ee_2
\end{align*}
Because $\ee_i \cdot \ee_j = \delta_{ij}$, we get, 
\begin{align*}
 \Curl \Psi^{1}_{\jj} \ee_{1} \cdot \Curl \Psi^{1}_{\ii} \ee_{1} &=  
    \partial_{x_3} \Psi^{1}_{\jj} ~ \partial_{x_3} \Psi^{1}_{\ii} 
  + \partial_{x_2} \Psi^{1}_{\jj} ~ \partial_{x_2} \Psi^{1}_{\ii}
 \\
 \Curl \Psi^{1}_{\jj} \ee_{1} \cdot \Curl \Psi^{2}_{\ii} \ee_{2} &= 
 - \partial_{x_2} \Psi^{1}_{\jj} ~ \partial_{x_1} \Psi^{2}_{\ii}
 \\
 \Curl \Psi^{1}_{\jj} \ee_{1} \cdot \Curl \Psi^{3}_{\ii} \ee_{3} &=  
 - \partial_{x_3} \Psi^{1}_{\jj} ~ \partial_{x_1} \Psi^{3}_{\ii}
 \\
% \Curl \Psi^{2}_{\jj} \ee_{2} \cdot \Curl \Psi^{1}_{\ii} \ee_{1} &=  
% - \partial_{x_1} \Psi^{2}_{\jj} ~ \partial_{x_2} \Psi^{1}_{\jj}
% \\
 \Curl \Psi^{2}_{\jj} \ee_{2} \cdot \Curl \Psi^{2}_{\ii} \ee_{2} &= 
   \partial_{x_3} \Psi^{2}_{\jj} ~ \partial_{x_3} \Psi^{2}_{\ii} 
 + \partial_{x_1} \Psi^{2}_{\jj} ~ \partial_{x_1} \Psi^{2}_{\ii}
 \\
 \Curl \Psi^{2}_{\jj} \ee_{2} \cdot \Curl \Psi^{3}_{\ii} \ee_{3} &=  
 - \partial_{x_3} \Psi^{2}_{\jj} ~  \partial_{x_2} \Psi^{3}_{\ii} 
 \\
% \Curl \Psi^{3}_{\jj} \ee_{3} \cdot \Curl \Psi^{1}_{\ii} \ee_{1} &=  
% - \partial_{x_1} \Psi^{3}_{\jj} ~ \partial_{x_3} \Psi^{1}_{\ii} 
% \\
% \Curl \Psi^{3}_{\jj} \ee_{3} \cdot \Curl \Psi^{2}_{\ii} \ee_{2} &= 
% - \partial_{x_2} \Psi^{3}_{\jj} ~ \partial_{x_3} \Psi^{2}_{\ii} 
% \\
 \Curl \Psi^{3}_{\jj} \ee_{3} \cdot \Curl \Psi^{3}_{\ii} \ee_{3} &=  
   \partial_{x_2} \Psi^{3}_{\jj} ~ \partial_{x_2} \Psi^{3}_{\ii} 
 + \partial_{x_1} \Psi^{3}_{\jj} ~ \partial_{x_1} \Psi^{3}_{\ii}
\end{align*}
we find that $A$ is a symmetric $3\times 3$ block matrix of the form
\begin{align}
  A = 
  \begin{pmatrix}
    A_{11}   & A_{12}   &  A_{13} \\
    A_{12}^T & A_{22}   &  A_{23} \\
    A_{13}^T & A_{23}^T &  A_{33} 
  \end{pmatrix}
%  \label{}
\end{align}
where
\begin{align*}
  {A_{11}}_{\ii, \jj} &=   \int_{\Omega} 
          \partial_{x_3} \Psi^{1}_{\jj} \partial_{x_3} \Psi^{1}_{\ii} 
        + \partial_{x_2} \Psi^{1}_{\jj} \partial_{x_2} \Psi^{1}_{\ii}
        \dd \mathbf{x} 
                       +   \int_{\Omega} 
                       \tau \Psi^{1}_{\jj} \Psi^{1}_{\ii} 
        \dd \mathbf{x} 
  \\
  {A_{12}}_{\ii, \jj} &= - \int_{\Omega} 
          \partial_{x_2} \Psi^{1}_{\jj} \partial_{x_1} \Psi^{2}_{\ii}
        \dd \mathbf{x} 
  \\
  {A_{13}}_{\ii, \jj} &= -  \int_{\Omega} 
         \partial_{x_3} \Psi^{1}_{\jj} \partial_{x_1} \Psi^{3}_{\ii}
        \dd \mathbf{x} 
  \\
%  {A_{21}}_{\ii, \jj} &= -   \int_{\Omega} 
%        \partial_{x_1} \Psi^{2}_{\jj} ~ \partial_{x_2} \Psi^{1}_{\jj}
%        \dd \mathbf{x} 
%  \\
  {A_{22}}_{\ii, \jj} &=   \int_{\Omega} 
         \partial_{x_3} \Psi^{2}_{\jj} ~ \partial_{x_3} \Psi^{2}_{\ii} 
       + \partial_{x_1} \Psi^{2}_{\jj} ~ \partial_{x_1} \Psi^{2}_{\ii}
        \dd \mathbf{x} 
                       +   \int_{\Omega} 
                       \tau \Psi^{2}_{\jj} \Psi^{2}_{\ii} 
        \dd \mathbf{x} 
  \\
  {A_{23}}_{\ii, \jj} &=  -  \int_{\Omega} 
       \partial_{x_3} \Psi^{2}_{\jj} ~  \partial_{x_2} \Psi^{3}_{\ii} 
        \dd \mathbf{x} 
  \\
%  {A_{31}}_{\ii, \jj} &= -   \int_{\Omega} 
%        \partial_{x_1} \Psi^{3}_{\jj} ~ \partial_{x_3} \Psi^{1}_{\ii} 
%        \dd \mathbf{x} 
%  \\
%  {A_{32}}_{\ii, \jj} &= -   \int_{\Omega} 
%       \partial_{x_2} \Psi^{3}_{\jj} ~ \partial_{x_3} \Psi^{2}_{\ii} 
%        \dd \mathbf{x} 
%  \\
  {A_{33}}_{\ii, \jj} &=   \int_{\Omega} 
         \partial_{x_2} \Psi^{3}_{\jj} ~ \partial_{x_2} \Psi^{3}_{\ii} 
       + \partial_{x_1} \Psi^{3}_{\jj} ~ \partial_{x_1} \Psi^{3}_{\ii}
        \dd \mathbf{x} 
                       +   \int_{\Omega} 
                       \tau \Psi^{3}_{\jj} \Psi^{3}_{\ii} 
        \dd \mathbf{x} 
\end{align*}
For the right hand side, the entries associated to each component of the vector $\ff$ are given by
\begin{align*}
    F_{1, i} & = \int_{\Omega} \ff_1 \Psi^1_{i} \dd \mathbf{x} \\
    F_{2, i} & = \int_{\Omega} \ff_2 \Psi^2_{i} \dd \mathbf{x} \\
    F_{3, i} & = \int_{\Omega} \ff_3 \Psi^3_{i} \dd \mathbf{x} 
\end{align*}
\subsubsection*{Case without mapping}
When the computational domain is a cube, one can express the previous matrices in terms of Kronecker product.
%Before expliciting the matrix forms in 2D and 3D, we start by introducing some 1D matrices that we will need.
%\begin{align}
%  \begin{cases}
%    \left( M_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Nis \Njs \dd x_s
%    \\
%    \left( K_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Nis^\prime \Njs^\prime \dd x_s
%    \\
%    \left( D_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Mis \Mjs \dd x_s
%    \\
%    \left( R_{s} \right)_{i_s, j_s} &= \int_{0}^1 \Nis^\prime \Mjs \dd x_s
%  \end{cases}
%\end{align}
Hence, we have,
\begin{align*}
  \begin{cases}
    {A_{11}}_{\ii, \jj} &= \left( D_1 \otimes M_2 \otimes K_3 \right)_{\ii \jj} 
                         + \left( D_1 \otimes K_2 \otimes M_3 \right)_{\ii \jj} 
                         + \tau \left( D_1 \otimes M_2 \otimes M_3 \right)_{\ii \jj} 
    \\
    {A_{12}}_{\ii, \jj} &= - \left( R_1 \otimes R_2^T \otimes M_3 \right)_{\ii \jj} 
    \\
    {A_{13}}_{\ii, \jj} &= - \left( R_1 \otimes M_2 \otimes R_3^T \right)_{\ii \jj} 
    \\
    {A_{22}}_{\ii, \jj} & = \left( M_1 \otimes D_2 \otimes K_3 \right)_{\ii \jj} 
                         + \left( K_1 \otimes D_2 \otimes M_3 \right)_{\ii \jj} 
                         + \tau \left( M_1 \otimes D_2 \otimes M_3 \right)_{\ii \jj} 
    \\
    {A_{23}}_{\ii, \jj} &= - \left( M_1 \otimes R_2 \otimes R_3^T \right)_{\ii \jj} 
    \\
    {A_{33}}_{\ii, \jj} &= \left( M_1 \otimes K_2 \otimes D_3 \right)_{\ii \jj} 
                         + \left( K_1 \otimes M_2 \otimes D_3 \right)_{\ii \jj} 
                         + \tau \left( M_1 \otimes M_2 \otimes D_3 \right)_{\ii \jj} 
  \end{cases}
\end{align*}
Therefor, we have the following matrix form 
\begin{align}
  \mathcal{A}^\tau = \mathcal{A}^0 + \tau \mathcal{M}
%  \label{}
\end{align}
where
\begin{align}
  \mathcal{A}^0 = 
  \begin{pmatrix}
    D_1 \otimes M_2 \otimes K_3 + D_1 \otimes K_2 \otimes M_3  &                          - R_1 \otimes R_2^T \otimes M_3   &  - R_1 \otimes M_2 \otimes R_3^T \\
                               - R_1^T \otimes R_2 \otimes M_3 & M_1 \otimes D_2 \otimes K_3 + K_1 \otimes D_2 \otimes M_3  &  - M_1 \otimes R_2 \otimes R_3^T \\
                               - R_1^T \otimes M_2 \otimes R_3 &                          - M_1 \otimes R_2^T \otimes R_3   & M_1 \otimes K_2 \otimes D_3 + K_1 \otimes M_2 \otimes D_3  
  \end{pmatrix}
  \label{eq:matrix-A0-3d}
\end{align}
and
\begin{align}
  \mathcal{M} = 
  \begin{pmatrix}
    D_1 \otimes M_2 \otimes M_3   & 0   &  0 \\
    0 & M_1 \otimes D_2 \otimes M_3   &  0 \\
    0 & 0 &  M_1 \otimes M_2 \otimes D_3 
  \end{pmatrix}
  \label{eq:matrix-M-3d}
\end{align}
